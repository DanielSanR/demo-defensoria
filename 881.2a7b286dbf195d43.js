(self.webpackChunkapp=self.webpackChunkapp||[]).push([[881],{881:(z,w,_)=>{"use strict";_.r(w),_.d(w,{MapPageModule:()=>T});var f=_(6895),n=_(4719),p=_(9250),S=_(8359),M=_(5861),b=_(8407),u=(_(8928),_(6738)),k=_(591),P=_(1188),C=_(849);let L=(()=>{class h{constructor(d,t,e){this.plt=d,this.storageService=t,this.storage=e,this.properties=[],this.hospitales=[],this.ltlng=new k.X(null),this.greenIcon=new b.Icon({iconUrl:"../../assets/icon/policia.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[42,42],iconAnchor:[42,42],popupAnchor:[1,-34],shadowSize:[32,32]}),this.hospitalIcon=new b.Icon({iconUrl:"../../assets/icon/hospital.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[42,42],iconAnchor:[42,42],popupAnchor:[1,-34],shadowSize:[32,32]}),this.key="AAPK895f48d83b5543ab80c5d058d510d5971uhYgfFtvdNCIB-no6TgvFEbUE-H-h6ZfPfs9GOWCpAtsp9cTGA8zFsd2DiPWwPf",this.loadCoordenates()}loadCoordenates(){this.storageService.getStorage("latlng").then(d=>{this.ltlng.next(d||!1)})}getCoord(){return this.ltlng.asObservable()}generateMap(d){d||(d=[-27.366667,-55.896944]),void 0!==this.map&&this.map.remove(),this.map=new b.Map("map").setView([Number(d[0]),Number(d[1])],16),b.tileLayer("https://api.mapbox.com/styles/v1/danielsanr/cl7s448ej004i15lqz3hudwgv/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiZGFuaWVsc2FuciIsImEiOiJjbDdzNGJ3MTcwbHQyM3ZvODg5NHhxeTdzIn0.9FGfq9AypFMgmFR6gWjlFw",{maxZoom:19,attribution:"<a href='https://www.mapbox.com/about/maps/'>Mapbox</a> \xa9 <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> <strong><a href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a></strong>"}).addTo(this.map),fetch("./assets/datos/comisarias.json").then(t=>t.json()).then(t=>{this.properties=t;for(const o of this.properties){let s=o.descripcion>1?o.descripcion:"Direccion no disponible",l=o.nombre.length>1?o.nombre:"Nombre no disponible",r=o.ciudad.length>1?o.ciudad:"Ciudad no disponible",a=o.telefono.length>1?o.telefono:"Telefono no disponible";b.marker([o.longitud,o.latitud],{icon:this.greenIcon}).addTo(this.map).bindPopup(`<div style="font-weight: bold; text-align: center;">COMISARIA</div><hr><strong>Ciudad: </strong>${r}<br><strong>Nombre: </strong>${l}<br><strong>Direccion: </strong>${s}<br><strong>Telefono: </strong>${a}<br><hr>`)}b.circleMarker(d,{radius:50,color:"cornflowerblue",fillOpacity:.2,opacity:.5}).addTo(this.map)}),fetch("./assets/datos/hospitales.json").then(t=>t.json()).then(t=>{this.hospitales=t;for(const e of this.hospitales){console.log([e.Longitud,e.Latitud]);let i=e.Direccion>1?e.Direccion:"Direccion no disponible",s=e.Nombre.length>1?e.Nombre:"Nombre no disponible",l=e.Localidad.length>1?e.Localidad:"Ciudad no disponible",r=e.Telefono_1.length>1||e.Telefono_2.length>1?e.Telefono_1+" / "+e.Telefono_2:"Telefono no disponible";b.marker([e.Latitud,e.Longitud],{icon:this.hospitalIcon}).addTo(this.map).bindPopup(`<div style="font-weight: bold; text-align: center;">HOSPITAL</div><hr><strong>Ciudad: </strong>${l}<br><strong>Nombre: </strong>${s}<br><strong>Direccion: </strong>${i}<br><strong>Telefono: </strong>${r}<br><hr>`)}})}}return h.\u0275fac=function(d){return new(d||h)(u.LFG(p.t4),u.LFG(P.V),u.LFG(C.K))},h.\u0275prov=u.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();const F=[{path:"",component:(()=>{class h{constructor(d,t){this._mapService=d,this.loadingController=t,this.properties=[],this.$cords=this._mapService.ltlng,this.key="AAPK895f48d83b5543ab80c5d058d510d5971uhYgfFtvdNCIB-no6TgvFEbUE-H-h6ZfPfs9GOWCpAtsp9cTGA8zFsd2DiPWwPf",this.greenIcon=new b.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}ionViewDidEnter(){var d=this;return(0,M.Z)(function*(){d._mapService.loadCoordenates();const t=yield d.loadingController.create({message:"Loading...",spinner:"circles"});t.present(),d.$cords.subscribe(e=>{d.cords=e,d._mapService.generateMap(d.cords),t.dismiss()})})()}}return h.\u0275fac=function(d){return new(d||h)(u.Y36(L),u.Y36(p.HT))},h.\u0275cmp=u.Xpm({type:h,selectors:[["app-map"]],decls:19,vars:0,consts:[[1,"titulo"],[1,"titulo-label"],[1,"Grid"],[1,"Grid-row"],["size","2"],["src","../../assets/icon/hospital.svg"],["size","4",1,"Grid-row-col"],[1,"Grid-row-col-label"],[1,"Grid-row-col-label-badge"],["src","../../assets/icon/policia.svg"],["id","map"]],template:function(d,t){1&d&&(u.TgZ(0,"ion-content")(1,"div",0)(2,"ion-label",1),u._uU(3," Contactate con quien necesites "),u.qZA()(),u.TgZ(4,"ion-grid",2)(5,"ion-row",3)(6,"ion-col",4),u._UZ(7,"ion-icon",5),u.qZA(),u.TgZ(8,"ion-col",6)(9,"div",7)(10,"ion-label",8),u._uU(11," Hospitales "),u.qZA()()(),u.TgZ(12,"ion-col",4),u._UZ(13,"ion-icon",9),u.qZA(),u.TgZ(14,"ion-col",6)(15,"div",7)(16,"ion-label",8),u._uU(17," Comisar\xedas "),u.qZA()()()()(),u._UZ(18,"div",10),u.qZA())},dependencies:[p.wI,p.W2,p.jY,p.gu,p.Q$,p.Nd],styles:["ion-content[_ngcontent-%COMP%]{--background:#f4f4f4}.titulo[_ngcontent-%COMP%]{text-align:center;padding:34px 39px 9px;width:100%}.titulo-label[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#000}.Grid[_ngcontent-%COMP%]{padding:0 20px}.Grid[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:46px;height:46px}.Grid-row-col[_ngcontent-%COMP%]{padding-left:0;display:flex;flex-direction:row;justify-content:center;align-items:center}.Grid-row-col-label[_ngcontent-%COMP%]{background:linear-gradient(180deg,rgba(255,102,0,.76) 0%,rgba(254,145,14,.82) 100%);border-radius:40px;padding:6px 10px}.Grid-row-col-label-badge[_ngcontent-%COMP%]{font-weight:200;font-size:14px;color:#fff}#map[_ngcontent-%COMP%]{margin:20px;border:5px solid #FE910E;border-radius:15px;height:-moz-fit-content;height:fit-content;z-index:99999;width:auto;height:73%}"]}),h})()}];let D=(()=>{class h{}return h.\u0275fac=function(d){return new(d||h)},h.\u0275mod=u.oAB({type:h}),h.\u0275inj=u.cJS({imports:[S.Bz.forChild(F),S.Bz]}),h})(),T=(()=>{class h{}return h.\u0275fac=function(d){return new(d||h)},h.\u0275mod=u.oAB({type:h}),h.\u0275inj=u.cJS({imports:[f.ez,n.u5,p.Pc,D]}),h})()},8928:function(z,w,_){!function(f,n,p){"use strict";var S="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/",M=p.Task.extend({path:"findAddressCandidates",params:{outSr:4326,forStorage:!1,outFields:"*",maxLocations:20},setters:{address:"address",neighborhood:"neighborhood",city:"city",subregion:"subregion",region:"region",postal:"postal",country:"country",text:"singleLine",category:"category",token:"token",apikey:"apikey",key:"magicKey",fields:"outFields",forStorage:"forStorage",maxLocations:"maxLocations",countries:"sourceCountry"},initialize:function(t){(t=t||{}).url=t.url||S,p.Task.prototype.initialize.call(this,t)},within:function(t){return t=n.latLngBounds(t),this.params.searchExtent=p.Util.boundsToExtent(t),this},nearby:function(t,e){var o=n.latLng(t);return this.params.location=o.lng+","+o.lat,e&&(this.params.distance=Math.min(Math.max(e,2e3),5e4)),this},run:function(t,e){return this.options.token&&(this.params.token=this.options.token),this.options.apikey&&(this.params.token=this.options.apikey),this.options.customParam&&(this.params[this.options.customParam]=this.params.singleLine,delete this.params.singleLine),this.request(function(o,i){var l=o?void 0:(0,this._processGeocoderResponse)(i);t.call(e,o,{results:l},i)},this)},_processGeocoderResponse:function(t){for(var e=[],o=0;o<t.candidates.length;o++){var i=t.candidates[o];if(i.extent)var s=p.Util.extentToBounds(i.extent);e.push({text:i.address,bounds:s,score:i.score,latlng:n.latLng(i.location.y,i.location.x),properties:i.attributes})}return e}});function b(t){return new M(t)}var U=p.Task.extend({path:"reverseGeocode",params:{outSR:4326,returnIntersection:!1},setters:{distance:"distance",language:"langCode",intersection:"returnIntersection",apikey:"apikey"},initialize:function(t){(t=t||{}).url=t.url||S,p.Task.prototype.initialize.call(this,t)},latlng:function(t){var e=n.latLng(t);return this.params.location=e.lng+","+e.lat,this},run:function(t,e){return this.options.token&&(this.params.token=this.options.token),this.options.apikey&&(this.params.token=this.options.apikey),this.request(function(o,i){var s;s=o?void 0:{latlng:n.latLng(i.location.y,i.location.x),address:i.address},t.call(e,o,s,i)},this)}});function u(t){return new U(t)}var k=p.Task.extend({path:"suggest",params:{},setters:{text:"text",category:"category",countries:"countryCode",maxSuggestions:"maxSuggestions"},initialize:function(t){(t=t||{}).url||(t.url=S,t.supportsSuggest=!0),p.Task.prototype.initialize.call(this,t)},within:function(t){var e=(t=n.latLngBounds(t)).getCenter(),o=t.getNorthWest();return this.params.location=e.lng+","+e.lat,this.params.distance=Math.min(Math.max(e.distanceTo(o),2e3),5e4),this.params.searchExtent=p.Util.boundsToExtent(t),this},nearby:function(t,e){var o=n.latLng(t);return this.params.location=o.lng+","+o.lat,e&&(this.params.distance=Math.min(Math.max(e,2e3),5e4)),this},run:function(t,e){if(this.options.supportsSuggest)return this.request(function(o,i){t.call(e,o,i,i)},this);console.warn("this geocoding service does not support asking for suggestions")}});function P(t){return new k(t)}var C=p.Service.extend({initialize:function(t){(t=t||{}).apikey&&(t.token=t.apikey),t.url?(p.Service.prototype.initialize.call(this,t),this._confirmSuggestSupport()):(t.url=S,t.supportsSuggest=!0,p.Service.prototype.initialize.call(this,t))},geocode:function(){return b(this)},reverse:function(){return u(this)},suggest:function(){return P(this)},_confirmSuggestSupport:function(){this.metadata(function(t,e){t||(this.options.supportsSuggest=!!(e.capabilities&&e.capabilities.indexOf("Suggest")>-1),this.options.customParam=e.singleLineAddressField.name)},this)}}),L=n.Evented.extend({options:{zoomToResult:!0,useMapBounds:12,searchBounds:null},initialize:function(t,e){if(n.Util.setOptions(this,e),this._control=t,!e||!e.providers||!e.providers.length)throw new Error("You must specify at least one provider");this._providers=e.providers},_geocode:function(t,e,o){var i,s=0,l=[],r=n.Util.bind(function(c,g){s--,c||(g&&(l=l.concat(g)),s<=0&&(i=this._boundsFromResults(l),this.fire("results",{results:l,bounds:i,latlng:i?i.getCenter():void 0,text:t},!0),this.options.zoomToResult&&i&&this._control._map.fitBounds(i),this.fire("load")))},this);if(e)s++,o.results(t,e,this._searchBounds(),r);else for(var a=0;a<this._providers.length;a++)s++,this._providers[a].results(t,e,this._searchBounds(),r)},_suggest:function(t){var e=this._providers.length,o=0,i=n.Util.bind(function(a,c){return n.Util.bind(function(g,m){if(e-=1,o+=m.length,g)return this._control._clearProviderSuggestions(c),void this._control._finalizeSuggestions(e,o);if(m.length)for(var v=0;v<m.length;v++)m[v].provider=c;else this._control._renderSuggestions(m);c._lastRender!==a&&this._control._clearProviderSuggestions(c),m.length&&this._control._input.value===a&&(c._lastRender=a,this._control._renderSuggestions(m)),this._control._finalizeSuggestions(e,o)},this)},this);this._pendingSuggestions=[];for(var s=0;s<this._providers.length;s++){var l=this._providers[s],r=l.suggestions(t,this._searchBounds(),i(t,l));this._pendingSuggestions.push(r)}},_searchBounds:function(){return null!==this.options.searchBounds?this.options.searchBounds:!1===this.options.useMapBounds?null:!0===this.options.useMapBounds||this.options.useMapBounds<=this._control._map.getZoom()?this._control._map.getBounds():null},_boundsFromResults:function(t){if(t.length){for(var e=n.latLngBounds([0,0],[0,0]),o=[],i=[],s=t.length-1;s>=0;s--){var l=t[s];i.push(l.latlng),l.bounds&&l.bounds.isValid()&&!l.bounds.equals(e)&&o.push(l.bounds)}for(var r=n.latLngBounds(i),a=0;a<o.length;a++)r.extend(o[a]);return r}},_getAttribution:function(){for(var t=[],e=this._providers,o=0;o<e.length;o++)e[o].options.attribution&&t.push(e[o].options.attribution);return t.join(", ")}});function A(t,e){return new L(t,e)}var F=C.extend({options:{label:"Places and Addresses",maxResults:5},suggestions:function(t,e,o){var i=this.suggest().text(t);return e&&i.within(e),this.options.nearby&&i.nearby(this.options.nearby),this.options.countries&&i.countries(this.options.countries),this.options.categories&&i.category(this.options.categories),i.maxSuggestions(this.options.maxResults),i.run(function(s,l,r){var a=[];if(!s)for(;r.suggestions.length&&a.length<=this.options.maxResults-1;){var c=r.suggestions.shift();c.isCollection||a.push({text:c.text,unformattedText:c.text,magicKey:c.magicKey})}o(s,a)},this)},results:function(t,e,o,i){var s=this.geocode().text(t);return e&&s.key(e),s.maxLocations(this.options.maxResults),o&&s.within(o),this.options.forStorage&&s.forStorage(!0),this.options.nearby&&s.nearby(this.options.nearby),this.options.countries&&s.countries(this.options.countries),this.options.categories&&s.category(this.options.categories),s.run(function(l,r){i(l,r.results)},this)}});function D(t){return new F(t)}var T=n.Control.extend({includes:n.Evented.prototype,options:{position:"topleft",collapseAfterResult:!0,expanded:!1,allowMultipleResults:!0,placeholder:"Search for places or addresses",title:"Location Search"},initialize:function(t){n.Util.setOptions(this,t),t&&t.providers&&t.providers.length||(t||(t={}),t.providers=[D()]),this._geosearchCore=A(this,t),this._geosearchCore._providers=t.providers,this._geosearchCore.addEventParent(this);for(var e=0;e<this._geosearchCore._providers.length;e++)this._geosearchCore._providers[e].addEventParent(this);this._geosearchCore._pendingSuggestions=[],n.Control.prototype.initialize.call(this,t)},_renderSuggestions:function(t){var e,o,i;t.length>0&&(this._suggestions.style.display="block");for(var s=[],l=0;l<t.length;l++){var r=t[l];if(!i&&this._geosearchCore._providers.length>1&&e!==r.provider.options.label&&((i=n.DomUtil.create("div","geocoder-control-header",r.provider._contentsElement)).textContent=r.provider.options.label,i.innerText=r.provider.options.label,e=r.provider.options.label),o||(o=n.DomUtil.create("ul","geocoder-control-list",r.provider._contentsElement)),-1===s.indexOf(r.text)){var a=n.DomUtil.create("li","geocoder-control-suggestion",o);a.innerHTML=r.text,a.provider=r.provider,a["data-magic-key"]=r.magicKey,a.unformattedText=r.unformattedText}else for(var c=0;c<o.childNodes.length;c++)o.childNodes[c].innerHTML===r.text&&(o.childNodes[c]["data-magic-key"]+=","+r.magicKey);s.push(r.text)}this.getPosition().indexOf("top")>-1&&(this._suggestions.style.maxHeight=this._map.getSize().y-this._suggestions.offsetTop-this._wrapper.offsetTop-10+"px"),this.getPosition().indexOf("bottom")>-1&&this._setSuggestionsBottomPosition()},_setSuggestionsBottomPosition:function(){this._suggestions.style.maxHeight=this._map.getSize().y-this._map._controlCorners[this.getPosition()].offsetHeight-this._wrapper.offsetHeight+"px",this._suggestions.style.top=-this._suggestions.offsetHeight-this._wrapper.offsetHeight+20+"px"},_boundsFromResults:function(t){if(t.length){for(var e=n.latLngBounds([0,0],[0,0]),o=[],i=[],s=t.length-1;s>=0;s--){var l=t[s];i.push(l.latlng),l.bounds&&l.bounds.isValid()&&!l.bounds.equals(e)&&o.push(l.bounds)}for(var r=n.latLngBounds(i),a=0;a<o.length;a++)r.extend(o[a]);return r}},clear:function(){this._clearAllSuggestions(),this.options.collapseAfterResult&&(this._input.value="",this._lastValue="",this._input.placeholder="",n.DomUtil.removeClass(this._wrapper,"geocoder-control-expanded")),!this._map.scrollWheelZoom.enabled()&&this._map.options.scrollWheelZoom&&this._map.scrollWheelZoom.enable()},_clearAllSuggestions:function(){this._suggestions.style.display="none";for(var t=0;t<this.options.providers.length;t++)this._clearProviderSuggestions(this.options.providers[t])},_clearProviderSuggestions:function(t){t._contentsElement.innerHTML=""},_finalizeSuggestions:function(t,e){t||(n.DomUtil.removeClass(this._input,"geocoder-control-loading"),this.getPosition().indexOf("bottom")>-1&&this._setSuggestionsBottomPosition(),e||this._clearAllSuggestions())},_setupClick:function(){n.DomUtil.addClass(this._wrapper,"geocoder-control-expanded"),this._input.focus()},disable:function(){this._input.disabled=!0,n.DomUtil.addClass(this._input,"geocoder-control-input-disabled"),n.DomEvent.removeListener(this._wrapper,"click",this._setupClick,this)},enable:function(){this._input.disabled=!1,n.DomUtil.removeClass(this._input,"geocoder-control-input-disabled"),n.DomEvent.addListener(this._wrapper,"click",this._setupClick,this)},getAttribution:function(){for(var t=[],e=0;e<this._providers.length;e++)this._providers[e].options.attribution&&t.push(this._providers[e].options.attribution);return t.join(", ")},geocodeSuggestion:function(t){var e=t.target||t.srcElement;e.classList.contains("geocoder-control-suggestions")||e.classList.contains("geocoder-control-header")||(e.classList.length<1&&(e=e.parentNode),this._geosearchCore._geocode(e.unformattedText,e["data-magic-key"],e.provider),this.clear())},onAdd:function(t){p.Util.setEsriAttribution(t),this._map=t,this._wrapper=n.DomUtil.create("div","geocoder-control"),this._input=n.DomUtil.create("input","geocoder-control-input leaflet-bar",this._wrapper),this._input.title=this.options.title,this.options.expanded&&(n.DomUtil.addClass(this._wrapper,"geocoder-control-expanded"),this._input.placeholder=this.options.placeholder),this._suggestions=n.DomUtil.create("div","geocoder-control-suggestions leaflet-bar",this._wrapper);for(var e=0;e<this.options.providers.length;e++)this.options.providers[e]._contentsElement=n.DomUtil.create("div",null,this._suggestions);var o=this._geosearchCore._getAttribution();return t.attributionControl&&t.attributionControl.addAttribution(o),n.DomEvent.addListener(this._input,"focus",function(i){this._input.placeholder=this.options.placeholder,n.DomUtil.addClass(this._wrapper,"geocoder-control-expanded")},this),n.DomEvent.addListener(this._wrapper,"click",this._setupClick,this),n.DomEvent.addListener(this._suggestions,"mousedown",this.geocodeSuggestion,this),n.DomEvent.addListener(this._input,"blur",function(i){this.clear()},this),n.DomEvent.addListener(this._input,"keydown",function(i){var s=(i.target||i.srcElement).value;n.DomUtil.addClass(this._wrapper,"geocoder-control-expanded");for(var l,r=this._suggestions.querySelectorAll(".geocoder-control-suggestion"),a=this._suggestions.querySelectorAll(".geocoder-control-selected")[0],c=0;c<r.length;c++)if(r[c]===a){l=c;break}switch(i.keyCode){case 13:a?(this._input.value=a.innerText,this._geosearchCore._geocode(a.unformattedText,a["data-magic-key"],a.provider),this.clear()):this.options.allowMultipleResults&&s.length>=2?(this._geosearchCore._geocode(this._input.value,void 0),this.clear()):1===r.length?(n.DomUtil.addClass(r[0],"geocoder-control-selected"),this._geosearchCore._geocode(r[0].innerHTML,r[0]["data-magic-key"],r[0].provider)):(this.clear(),this._input.blur()),n.DomEvent.preventDefault(i);break;case 38:a&&n.DomUtil.removeClass(a,"geocoder-control-selected");var g=r[l-1];n.DomUtil.addClass(a&&g?g:r[r.length-1],"geocoder-control-selected"),n.DomEvent.preventDefault(i);break;case 40:a&&n.DomUtil.removeClass(a,"geocoder-control-selected");var m=r[l+1];n.DomUtil.addClass(a&&m?m:r[0],"geocoder-control-selected"),n.DomEvent.preventDefault(i);break;default:for(var v=0;v<this._geosearchCore._pendingSuggestions.length;v++){var y=this._geosearchCore._pendingSuggestions[v];y&&y.abort&&!y.id&&y.abort()}}},this),n.DomEvent.addListener(this._input,"keyup",n.Util.throttle(function(i){var s=i.which||i.keyCode,l=(i.target||i.srcElement).value;if(l.length<2)return this._lastValue=this._input.value,this._clearAllSuggestions(),void n.DomUtil.removeClass(this._input,"geocoder-control-loading");27!==s?13!==s&&38!==s&&40!==s&&this._input.value!==this._lastValue&&(this._lastValue=this._input.value,n.DomUtil.addClass(this._input,"geocoder-control-loading"),this._geosearchCore._suggest(l)):this._clearAllSuggestions()},50,this),this),n.DomEvent.disableClickPropagation(this._wrapper),n.DomEvent.addListener(this._suggestions,"mouseover",function(i){t.scrollWheelZoom.enabled()&&t.options.scrollWheelZoom&&t.scrollWheelZoom.disable()}),n.DomEvent.addListener(this._suggestions,"mouseout",function(i){!t.scrollWheelZoom.enabled()&&t.options.scrollWheelZoom&&t.scrollWheelZoom.enable()}),this._geosearchCore.on("load",function(i){n.DomUtil.removeClass(this._input,"geocoder-control-loading"),this.clear(),this._input.blur()},this),this._wrapper}}),h=p.FeatureLayerService.extend({options:{label:"Feature Layer",maxResults:5,bufferRadius:1e3,searchMode:"contain",formatSuggestion:function(t){return t.properties[this.options.searchFields[0]]}},initialize:function(t){t.apikey&&(t.token=t.apikey),p.FeatureLayerService.prototype.initialize.call(this,t),"string"==typeof this.options.searchFields&&(this.options.searchFields=[this.options.searchFields]),this._suggestionsQuery=this.query(),this._resultsQuery=this.query()},suggestions:function(t,e,o){var i=this._suggestionsQuery.where(this._buildQuery(t)).returnGeometry(!1);return e&&i.intersects(e),this.options.idField&&i.fields([this.options.idField].concat(this.options.searchFields)),i.run(function(s,l,r){if(s)o(s,[]);else{this.options.idField=r.objectIdFieldName;for(var a=[],c=l.features.length-1;c>=0;c--){var g=l.features[c];a.push({text:this.options.formatSuggestion.call(this,g),unformattedText:g.properties[this.options.searchFields[0]],magicKey:g.id})}o(s,a.slice(0,this.options.maxResults))}},this)},results:function(t,e,o,i){var s=this._resultsQuery;return e?(delete s.params.where,s.featureIds([e])):s.where(this._buildQuery(t)),o&&s.within(o),s.run(n.Util.bind(function(l,r){for(var a=[],c=0;c<r.features.length;c++){var g=r.features[c];if(g){var m=this._featureBounds(g),v={latlng:m.getCenter(),bounds:m,text:this.options.formatSuggestion.call(this,g),properties:g.properties,geojson:g};a.push(v),delete this._resultsQuery.params.objectIds}}i(l,a)},this))},orderBy:function(t,e){this._suggestionsQuery.orderBy(t,e)},_buildQuery:function(t){for(var e=[],o=this.options.searchFields.length-1;o>=0;o--){var i='upper("'+this.options.searchFields[o]+'")';if("contain"===this.options.searchMode)e.push(i+" LIKE upper('%"+t+"%')");else if("startWith"===this.options.searchMode)e.push(i+" LIKE upper('"+t+"%')");else if("endWith"===this.options.searchMode)e.push(i+" LIKE upper('%"+t+"')");else{if("strict"!==this.options.searchMode)throw new Error('L.esri.Geocoding.featureLayerProvider: Invalid parameter for "searchMode". Use one of "contain", "startWith", "endWith", or "strict"');e.push(i+" LIKE upper('"+t+"')")}}return this.options.where?this.options.where+" AND ("+e.join(" OR ")+")":e.join(" OR ")},_featureBounds:function(t){var e=n.geoJson(t);if("Point"===t.geometry.type){var o=e.getBounds().getCenter(),i=this.options.bufferRadius/40075017*360/Math.cos(180/Math.PI*o.lat),s=this.options.bufferRadius/40075017*360;return n.latLngBounds([o.lat-s,o.lng-i],[o.lat+s,o.lng+i])}return e.getBounds()}}),x=p.MapService.extend({options:{layers:[0],label:"Map Service",bufferRadius:1e3,maxResults:5,formatSuggestion:function(t){return t.properties[t.displayFieldName]+" <small>"+t.layerName+"</small>"}},initialize:function(t){t.apikey&&(t.token=t.apikey),p.MapService.prototype.initialize.call(this,t),this._getIdFields()},suggestions:function(t,e,o){return this.find().text(t).fields(this.options.searchFields).returnGeometry(!1).layers(this.options.layers).run(function(i,s,l){var r=[];if(!i){var a=Math.min(this.options.maxResults,s.features.length);l.results=l.results.reverse();for(var c=0;c<a;c++){var g=s.features[c],m=l.results[c],v=m.layerId,y=this._idFields[v];g.layerId=v,g.layerName=this._layerNames[v],g.displayFieldName=this._displayFields[v],y&&r.push({text:this.options.formatSuggestion.call(this,g),unformattedText:g.properties[g.displayFieldName],magicKey:m.attributes[y]+":"+v})}}o(i,r.reverse())},this)},results:function(t,e,o,i){var s,l=[];if(e&&!e.includes(",")){var r=e.split(":")[0],a=e.split(":")[1];s=this.query().layer(a).featureIds(r)}else s=this.find().text(t).fields(this.options.searchFields).layers(this.options.layers);return s.run(function(c,g,m){if(!c){m.results&&(m.results=m.results.reverse());for(var v=0;v<g.features.length;v++){var y=g.features[v];if(a=a||m.results[v].layerId,y&&void 0!==a){var E=this._featureBounds(y);y.layerId=a,y.layerName=this._layerNames[a],y.displayFieldName=this._displayFields[a];var B={latlng:E.getCenter(),bounds:E,text:this.options.formatSuggestion.call(this,y),properties:y.properties,geojson:y};l.push(B)}}}i(c,l.reverse())},this)},_featureBounds:function(t){var e=n.geoJson(t);if("Point"===t.geometry.type){var o=e.getBounds().getCenter(),i=this.options.bufferRadius/40075017*360/Math.cos(180/Math.PI*o.lat),s=this.options.bufferRadius/40075017*360;return n.latLngBounds([o.lat-s,o.lng-i],[o.lat+s,o.lng+i])}return e.getBounds()},_layerMetadataCallback:function(t){return n.Util.bind(function(e,o){if(!e){this._displayFields[t]=o.displayField,this._layerNames[t]=o.name;for(var i=0;i<o.fields.length;i++){var s=o.fields[i];if("esriFieldTypeOID"===s.type){this._idFields[t]=s.name;break}}}},this)},_getIdFields:function(){this._idFields={},this._displayFields={},this._layerNames={};for(var t=0;t<this.options.layers.length;t++){var e=this.options.layers[t];this.get(e,{},this._layerMetadataCallback(e))}}}),d=C.extend({options:{label:"Geocode Server",maxResults:5},suggestions:function(t,e,o){if(this.options.supportsSuggest){var i=this.suggest().text(t);return e&&i.within(e),i.run(function(s,l,r){var a=[];if(!s)for(;r.suggestions.length&&a.length<=this.options.maxResults-1;){var c=r.suggestions.shift();c.isCollection||a.push({text:c.text,unformattedText:c.text,magicKey:c.magicKey})}o(s,a)},this)}return o(null,[]),!1},results:function(t,e,o,i){var s=this.geocode().text(t);return e&&s.key(e),s.maxLocations(this.options.maxResults),o&&s.within(o),s.run(function(l,r){i(l,r.results)},this)}});f.ArcgisOnlineProvider=F,f.FeatureLayerProvider=h,f.Geocode=M,f.GeocodeService=C,f.GeocodeServiceProvider=d,f.Geosearch=T,f.GeosearchCore=L,f.MapServiceProvider=x,f.ReverseGeocode=U,f.Suggest=k,f.VERSION="3.1.3",f.WorldGeocodingServiceUrl=S,f.arcgisOnlineProvider=D,f.featureLayerProvider=function(t){return new h(t)},f.geocode=b,f.geocodeService=function(t){return new C(t)},f.geocodeServiceProvider=function(t){return new d(t)},f.geosearch=function(t){return new T(t)},f.geosearchCore=A,f.mapServiceProvider=function(t){return new x(t)},f.reverseGeocode=u,f.suggest=P,Object.defineProperty(f,"__esModule",{value:!0})}(w,_(8407),_(9912))}}]);